<!DOCTYPE html>
<html>
<head>
  <title>Car Dodge Game 1</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      overflow: hidden; /* Prevent scrolling */
    }
    canvas {
      display: block; /* Remove extra space below the canvas */
      background: lightblue; /* Default background */
      width: 100%;
      height: 100vh;
    }
    #startGameButton, #startOverButton {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 20px;
      font-size: 18px;
      z-index: 1;
    }
  </style>
</head>
<body>
  <canvas id="carCanvas"></canvas>
  <button id="startGameButton">Start Game</button>
  <button id="startOverButton" style="display:none;">Start Over</button>

  <script>
    var canvas = document.getElementById("carCanvas");
    var ctx = canvas.getContext("2d");
    adjustCanvasSize();

    var carX = canvas.width / 2;
    var carY = canvas.height - 150;
    var carWidth = 100;
    var carHeight = 40;
    var carSpeed = 4;

    var roadY = canvas.height - 100;
    var roadColor = "gray";

    var score = 0;
    var lives = 3;
    var gameOver = false;
    var gameStarted = false;

    var startGameButton = document.getElementById("startGameButton");
    var startOverButton = document.getElementById("startOverButton");

    function adjustCanvasSize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }

    function requestDeviceOrientation() {
      if (typeof DeviceOrientationEvent.requestPermission === 'function') {
        DeviceOrientationEvent.requestPermission()
          .then(permissionState => {
            if (permissionState === 'granted') {
              window.addEventListener('deviceorientation', handleOrientation, true);
            } else {
              alert("Device orientation permission not granted");
            }
          })
          .catch(console.error);
      } else {
        window.addEventListener('deviceorientation', handleOrientation, true);
      }
    }

    startGameButton.addEventListener('click', function() {
      gameStarted = true;
      startGameButton.style.display = "none";
      requestDeviceOrientation();
      animate();
    });

    startOverButton.addEventListener('click', function() {
      resetGame();
    });

    function resetGame() {
      score = 0;
      lives = 3;
      gameOver = false;
      carX = canvas.width / 2;
      startOverButton.style.display = "none";
      startGameButton.style.display = "block";
    }

    function handleOrientation(event) {
      var gamma = event.gamma; // Left to right tilt
      carSpeed = gamma / 45 * 5;
    }

    function drawBackground() {
      ctx.fillStyle = "lightblue";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Additional background elements like the road can be drawn here
    }

    function drawCar() {
      ctx.fillStyle = "blue";
      ctx.fillRect(carX - carWidth / 2, carY, carWidth, carHeight); // Center the car on carX
    }

    function updateGameObjects() {
      // This function would update game objects like moving obstacles or other elements
      // For simplicity, it's left empty here
    }

    function updateScoreAndLives() {
      ctx.font = "20px Arial";
      ctx.fillStyle = "black";
      ctx.fillText("Score: " + score, 10, 30);
      ctx.fillText("Lives: " + lives, 10, 60);
    }

    function animate() {
      if (!gameStarted || gameOver) {
        return;
      }

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      drawBackground();
      updateGameObjects();
      drawCar();
      updateScoreAndLives();

      carX += carSpeed; // Move the car based on the current speed
      carX = Math.max(carWidth / 2, Math.min(canvas.width - carWidth / 2, carX)); // Prevent car from going out of bounds

      requestAnimationFrame(animate);
    }

    window.addEventListener('resize', adjustCanvasSize);
  </script>
</body>
</html>
